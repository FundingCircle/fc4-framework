#!/bin/bash

## This script is meant to be included in distribution packages and installed on
## end-users’ systems. It is for running compiled and packaged versions of fc4.

set -e

SCRIPT_DIR="${BASH_SOURCE%/*}"

JVM_OPTS=()

# This was originally introduced for obscure technical reasons related to the old, since-removed,
# Node renderer, which was executed as a separate process (at the OS level) and the IPC was impacted
# by the OS’s default character encoding setting, which we had to override. *That* reason for this
# setting no longer applies, but I’m keeping it around for now because I kinda like the idea of the
# tool using UTF8 no matter what, because some OS’s do use ASCII as their default character encoding
# setting, and I want YAML files containing “extended Unicode characters” (e.g. emoji) to be read
# correctly. This may be naive and problematic and may need to be revisited at some point.
JVM_OPTS+=("-Dfile.encoding=UTF8")

# Prevent the Java app icon from popping up and grabbing focus on MacOS.
JVM_OPTS+=("-Dapple.awt.UIElement=true")

# Prevent Clojure from performing reflective access across modules, and therefore prevent the JVM
# from outputting warnings, as per https://clojure.org/guides/faq#illegal_access
JVM_OPTS+=("--illegal-access=deny")

java "${JVM_OPTS[@]}" -jar "$SCRIPT_DIR/fc4.jar" "$@"
