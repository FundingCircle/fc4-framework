#!/usr/bin/env bash

set -eux -o pipefail

OS=$(~/project/.circleci/bin/which-os)

case $OS in
'linux-arch')
  # We need sudo and tar in order to install Clojure.
  pacman --refresh --sync --needed --noconfirm --noprogressbar sudo tar
  ~/project/tool/bin/install-clojure-linux
  ;;
'linux-debian')
  ~/project/tool/bin/install-clojure-linux
  ;;
'mac')
  export HOMEBREW_NO_AUTO_UPDATE=1 HOMEBREW_NO_BOTTLE_SOURCE_FALLBACK=1 HOMEBREW_NO_INSTALL_CLEANUP=1
  time brew install clojure
  ;;
*)
  echo "ERROR: '$OS' is not a supported OS; see the source of this script for accepted values."
  exit 1
esac
